<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSE Sentiment Analysis</title>
    <style>
        /* ... previous styles ... */
        .price-change-positive {
            color: #22c55e;
        }
        .price-change-negative {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSE Sentiment Analysis</h1>
        <div class="search-form">
            <input type="text" id="tickerInput" placeholder="Enter stock ticker (e.g., ECL)" oninput="this.value = this.value.toUpperCase()">
            <button onclick="addTicker()">Add Ticker</button>
        </div>

        <div class="note">
            Market prices are updated daily around 3 PM. Previous day's prices are shown until new data is available.
        </div>

        <table id="tickerTable">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Current Price ($)</th>
                    <th>Price Change</th>
                    <th>Date Added</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tickerTableBody">
                <!-- Tickers will be added here -->
            </tbody>
        </table>
    </div>

    <script>
        // Market data with current and previous prices
        const stockData = {
            '138SL': { currentPrice: 4.07, previousPrice: 6.07 }, // Previous price from change: (2.00)
            'ECL': { currentPrice: 3.27, previousPrice: 3.22 },   // Previous price from change: 5.00
            'FTNA': { currentPrice: 9.21, previousPrice: 9.11 },  // Previous price from change: 10.00
            'HONBUN': { currentPrice: 8.14, previousPrice: 7.94 }, // Previous price from change: 20.00
            // ... parse the rest of the data from the trade sheet
        };

        // Keep track of last update time
        let lastUpdateTime = new Date();
        const updateHour = 15; // 3 PM

        function isMarketDataCurrent() {
            const now = new Date();
            // If it's before 3 PM, use previous day's data
            if (now.getHours() < updateHour) {
                return false;
            }
            return true;
        }

        function getCurrentPrice(ticker) {
            if (!stockData[ticker]) return null;
            
            if (isMarketDataCurrent()) {
                return stockData[ticker].currentPrice;
            } else {
                return stockData[ticker].previousPrice;
            }
        }

        function getPriceChange(ticker) {
            if (!stockData[ticker]) return null;
            return stockData[ticker].currentPrice - stockData[ticker].previousPrice;
        }

        function addTickerToTable(ticker) {
            const tbody = document.getElementById('tickerTableBody');
            const row = tbody.insertRow();
            
            // Ticker symbol
            row.insertCell(0).textContent = ticker.symbol;
            
            // Current price
            const price = getCurrentPrice(ticker.symbol);
            row.insertCell(1).textContent = price ? price.toFixed(2) : 'N/A';
            
            // Price change
            const priceChange = getPriceChange(ticker.symbol);
            const changeCell = row.insertCell(2);
            if (priceChange !== null) {
                const changeText = priceChange >= 0 ? `+${priceChange.toFixed(2)}` : priceChange.toFixed(2);
                changeCell.textContent = changeText;
                changeCell.className = priceChange >= 0 ? 'price-change-positive' : 'price-change-negative';
            } else {
                changeCell.textContent = 'N/A';
            }
            
            // Date added
            row.insertCell(3).textContent = new Date(ticker.dateAdded).toLocaleDateString();
            
            // Delete button
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Remove';
            deleteButton.style.backgroundColor = '#dc3545';
            deleteButton.onclick = function() {
                row.remove();
                saveTickers();
            };
            
            row.insertCell(4).appendChild(deleteButton);
        }

        // ... rest of the previous functions (addTicker, saveTickers, etc.) ...
    </script>
</body>
</html>
