<script>
    let stockPrices = {};

    async function fetchStockPrices() {
        try {
            const response = await fetch("https://raw.githubusercontent.com/matthewpres/JSE-Sentiment/refs/heads/main/tickers.json");
            stockPrices = await response.json();
            console.log("Stock Prices Loaded:", stockPrices);
        } catch (error) {
            console.error("Error fetching tickers:", error);
        }
    }

    fetchStockPrices(); // Fetch tickers on page load

    function updateAutocomplete() {
        const value = document.getElementById('tickerInput').value.toUpperCase();
        const autocompleteList = document.getElementById('autocompleteList');
        autocompleteList.innerHTML = '';

        if (!value) return;

        Object.keys(stockPrices).forEach(ticker => {
            if (ticker.startsWith(value)) {
                const div = document.createElement('div');
                div.textContent = ticker;
                div.addEventListener('click', function() {
                    document.getElementById('tickerInput').value = ticker;
                    autocompleteList.innerHTML = '';
                });
                autocompleteList.appendChild(div);
            }
        });
    }

    function addPrediction() {
        const ticker = document.getElementById('tickerInput').value.toUpperCase();
        const predictionPrice = parseFloat(document.getElementById('priceInput').value);
        const errorMessageEl = document.getElementById('errorMessage');

        if (!ticker || isNaN(predictionPrice) || !(ticker in stockPrices)) {
            errorMessageEl.textContent = 'Invalid ticker or missing price.';
            return;
        }

        console.log("Prediction added:", { ticker, predictionPrice });
        errorMessageEl.textContent = "Prediction submitted successfully!";
        errorMessageEl.style.color = "green";
    }

    document.getElementById('tickerInput').addEventListener('input', updateAutocomplete);
</script>
